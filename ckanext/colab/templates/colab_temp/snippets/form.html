{# Data Contributor Registration Form - Portal Version #}
<div class="contributor-registration-form containerform">

<head>
    <script src="https://www.google.com/recaptcha/api.js?render={{ h.get_site_key() }}" async defer></script>
</head>


<!-- Form Introduction -->
<div class="form-intro">
    <section class="intro-card">
        <div class="intro-content">
            <p>{{ _('Welcome to the IHP WINS registration form. By completing this form, you will be able to contribute data and information on behalf of your organization on IHP WINS and the related Citizens4Water platform.') }}</p>

            <p>{{ _('Kindly note that your submission will undergo a verification process requiring your organization\'s official email address. This verification step ensures the security and authenticity of the data you submit.') }}</p>

            <p>{{ _('If you encounter any issues with the registration process, please contact us at ihp-wins@unesco.org for assistance.') }}</p>
        </div>
    </section>
</div>

<form method="POST" action="{{ h.url_for('colab.show_something') }}" id="data-contributor-form" novalidate>
    
    <!-- Personal Information Section -->
    <fieldset class="form-section">
        <legend>{{ _('Personal Information') }}</legend>
        <div class="form-section-content">
            
            <div class="form-group">
                <label for="fullname">{{ _('Full Name (Optional)') }}</label>
                <input type="text" id="fullname" name="fullname" placeholder="{{ _('Enter your full name') }}" class="form-control">
                <div class="help-text">{{ _('Your full name will help us personalize your experience') }}</div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="wins_username" class="required">{{ _('Username') }} <span class="text-danger">*</span></label>
                    <input type="text" id="wins_username" name="wins_username" pattern="[a-z0-9]*" minlength="4" maxlength="100" required placeholder="{{ _('e.g., john_doe123') }}" class="form-control">
                    <div class="help-text">{{ _('Your username should consist solely of lowercase letters and numbers.') }}</div>
                    <div class="field-error" id="username-error"></div>
                </div>
                <div class="form-group">
                    <label for="email" class="required">{{ _('Email') }} <span class="text-danger">*</span></label>
                    <input type="email" id="email" name="email" required placeholder="{{ _('your.email@organization.com') }}" class="form-control">
                    <div class="help-text">{{ _('Use your official organization email address') }}</div>
                    <div class="field-error" id="email-error"></div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="wins_password" class="required">{{ _('Password') }} <span class="text-danger">*</span></label>
                    <input type="password" id="wins_password" name="wins_password" minlength="8" required placeholder="{{ _('Enter a secure password') }}" class="form-control" autocomplete="new-password">
                    <div class="help-text">{{ _('Your password must be 8 characters or longer') }}</div>
                    <div class="password-strength" id="password-strength"></div>
                </div>
                <div class="form-group">
                    <label for="confirm-password" class="required">{{ _('Confirm password') }} <span class="text-danger">*</span></label>
                    <input type="password" id="confirm-password" name="confirm-password" minlength="8" required placeholder="{{ _('Repeat your password') }}" class="form-control" autocomplete="new-password">
                    <div class="help-text">{{ _('Passwords must match') }}</div>
                    <div id="match-message"></div>
                </div>
            </div>
        </div>
    </fieldset>

    <!-- Demographics Section -->
    <fieldset class="form-section">
        <legend>{{ _('Demographics') }}</legend>
        <div class="form-section-content">
            <div class="demographics-intro">
                <p class="section-description">{{ _('UNESCO\'s overarching priorities encompass gender equality, age inclusivity, and geographic diversity. Accordingly, we kindly request your input in the demography fields of this form to ensure we understand who our diverse contributors are.') }}</p>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="age" class="required">{{ _('Age') }} <span class="text-danger">*</span></label>
                    <input type="number" id="age" name="age" min="16" max="120" required placeholder="{{ _('Enter your age') }}" class="form-control">
                    <div class="help-text">{{ _('Must be 16 years or older') }}</div>
                </div>
                <div class="form-group">
                    <label for="nationality" class="required">{{ _('Nationality') }} <span class="text-danger">*</span></label>
                    <input type="text" id="nationality" name="nationality" required placeholder="{{ _('e.g., French, Canadian, etc.') }}" class="form-control">
                    <div class="help-text">{{ _('Your country of citizenship') }}</div>
                </div>
            </div>

            <div class="form-group">
                <label for="gender" class="required">{{ _('Gender') }} <span class="text-danger">*</span></label>
                <select name="gender" id="genderSelect" required class="form-control">
                    <option value="">{{ _('Please select your gender') }}</option>
                    <option value="woman">{{ _('Woman') }}</option>
                    <option value="man">{{ _('Man') }}</option>
                    <option value="other" id="genderOtherOption">{{ _('Other (to fill in)') }}</option>
                    <option value="preferNotToSay">{{ _('Prefer not to say') }}</option>
                </select>
                <input type="text" id="genderOtherText" name="genderOther" placeholder="{{ _('Please specify') }}" disabled class="form-control">
                <div class="help-text">{{ _('This information helps us ensure diverse representation') }}</div>
            </div>
        </div>
    </fieldset>

    <!-- Organization Section -->
    <fieldset class="form-section">
        <legend>{{ _('Organization') }}</legend>
        <div class="form-section-content">
            <div class="organization-intro">
                <p class="section-description">{{ _('To be a contributor for IHP WINS you need to be part of an organization. If your organization is not yet active in IHP WINS, you can create a new organization via this form.') }}</p>
            </div>

            <div class="form-group">
                <label for="organizationType">{{ _('Organization Type') }}</label>
                <select name="organizationType" id="organizationType" class="form-control">
                    <option value="">{{ _('Select organization type') }}</option>
                    <option value="unesco_ihp_secretariat">{{ _('UNESCO IHP Secretariat') }}</option>
                    <option value="unesco_field_office">{{ _('UNESCO Field Office') }}</option>
                    <option value="ihp_national_committee">{{ _('IHP National Committee') }}</option>
                    <option value="unesco_category_i_center">{{ _('UNESCO Category I Center') }}</option>
                    <option value="unesco_category_ii_center">{{ _('UNESCO Category II Center') }}</option>
                    <option value="unesco_chair_or_unitwin">{{ _('UNESCO Chair or UNITWIN') }}</option>
                    <option value="nongovernmental_organization">{{ _('Non-Governmental Organization') }}</option>
                    <option value="governmental_organization">{{ _('Governmental Organization') }}</option>
                    <option value="university">{{ _('University') }}</option>
                    <option value="private_partner">{{ _('Private Partner') }}</option>
                    <option value="research_institution">{{ _('Research Institution') }}</option>
                    <option value="other">{{ _('Other') }}</option>
                </select>
                <div class="help-text">{{ _('Select your affiliation to the UNESCO Water Family. If your organization is not related to the UNESCO Water Family, select other.') }}</div>
            </div>

            <div class="form-group">
                <label for="organization_name" class="required">{{ _('Organization Name') }} <span class="text-danger">*</span></label>
                <select name="organization_name" id="organization_name" required class="form-control">
                    <option value="">{{ _('Select an organization...') }}</option>
                    <option value="loading" disabled>{{ _('Loading organizations...') }}</option>
                </select>
                <div class="help-text">{{ _('Select your organization in the dropdown list or add a new organization.') }}</div>
            </div>

            <div id="newOrganizationField" class="new-organization-fields">
                <div class="form-group">
                    <label for="new_organization_name" class="required">{{ _('New Organization Name') }} <span class="text-danger">*</span></label>
                    <input type="text" id="new_organization_name" name="new_organization_name" placeholder="{{ _('Enter organization name') }}" class="form-control">
                    <div class="help-text">{{ _('Enter the official name of your organization') }}</div>
                </div>
                
                <div class="form-group">
                    <label for="new_organization_description">{{ _('Organization Description') }}</label>
                    <textarea id="new_organization_description" name="new_organization_description" rows="4" placeholder="{{ _('Describe your organization\'s mission and activities...') }}" class="form-control"></textarea>
                    <div class="help-text">{{ _('Brief description of your organization\'s purpose and activities') }}</div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="title_within_organization" class="required">{{ _('Title Within Represented Organization') }} <span class="text-danger">*</span></label>
                    <input type="text" id="title_within_organization" name="title_within_organization" required placeholder="{{ _('e.g., Data Manager, Research Coordinator') }}" class="form-control">
                    <div class="help-text">{{ _('Your current position or role in the organization') }}</div>
                </div>
                <div class="form-group">
                    <label for="user_role" class="required">{{ _('Role in Organization') }} <span class="text-danger">*</span></label>
                    <select name="user_role" id="user_role" required class="form-control">
                        <option value="">{{ _('Select your role') }}</option>
                        <option value="member">{{ _('Member') }}</option>
                        <option value="editor">{{ _('Editor') }}</option>
                        <option value="admin">{{ _('Admin') }}</option>
                    </select>
                    <div class="help-text">{{ _('For new organizations, only Admin role is available by default. For existing organizations, choose Editor if you will upload datasets, or Member if you only need to view private datasets.') }}</div>
                </div>
            </div>
        </div>
    </fieldset>

    <!-- Related Platforms Section -->
    <fieldset class="form-section" style="display:none;">
        <legend>{{ _('Related platforms') }}</legend>
        <div class="form-section-content">
            <div class="platforms-intro">
                <p class="section-description">{{ _('This registration form will allow you to contribute data and information on IHP WINS and related platforms. Select the related platforms you wish to contribute to.') }}</p>
            </div>
            
            <div class="form-group" style="display:none;">
                <div class="checkbox-container">
                    <input type="checkbox" id="citizens4water" name="citizens4water" value="yes">
                    <label for="citizens4water" class="checkbox-label">
                        {{ _('Citizens4Water platform') }}
                    </label>
                </div>
            </div>
        </div>
    </fieldset>

    <!-- Terms and Conditions -->
    <div class="terms-section">
        <div class="checkbox-container">
            <input type="checkbox" id="accept_guidelines" name="accept_guidelines" required>
            <label for="accept_guidelines" class="checkbox-label">
                {{ _('Accept and acknowledge the responsibilities and guidelines that the authorized user must follow when uploading data on behalf of the organization.') }}
            </label>
        </div>
    </div>

    <!-- reCAPTCHA -->
    <div class="recaptcha-section">
        <div class="g-recaptcha" id="recaptcha-container">
            <!-- reCAPTCHA will be inserted here by JavaScript -->
        </div>
        <input type="hidden" name="recaptcha_response" id="recaptchaResponse">
    </div>
    
    <!-- Hidden fields for debugging -->
    <input type="hidden" name="form_submitted" value="true">
    <input type="hidden" name="csrf_token" value="{{ request.csrf_token() if request.csrf_token else '' }}">
    
    <!-- Submit Button -->
    <div class="form-actions">
        <button type="submit" id="submit-button" class="btn btn-primary btn-lg">
            <i class="fa fa-paper-plane"></i> {{ _('Submit Application') }}
        </button>
        <div class="submit-help-text">
            {{ _('After submission, you will receive an email verification to complete your registration.') }}
        </div>
    </div>
</form>
</div>

<script>
(function() {
    'use strict';
    
    // DOM elements
    const form = document.getElementById('data-contributor-form');
    const genderSelect = document.getElementById('genderSelect');
    const genderOtherText = document.getElementById('genderOtherText');
    const organizationSelect = document.getElementById('organization_name');
    const newOrganizationField = document.getElementById('newOrganizationField');
    const newOrganizationNameField = document.getElementById('new_organization_name');
    const userRoleSelect = document.getElementById('user_role');
    const passwordField = document.getElementById('wins_password');
    const confirmPasswordField = document.getElementById('confirm-password');
    const matchMessage = document.getElementById('match-message');
    const submitButton = document.getElementById('submit-button');
    
    // Load organizations from API
    function loadOrganizations() {
        // Get base URL from current page
        const baseUrl = window.location.origin;
        
        // Make AJAX request to CKAN API
        fetch(`${baseUrl}/api/3/action/organization_list?all_fields=true`)
            .then(response => response.json())
            .then(data => {
                if (data.success && data.result) {
                    // Clear the select
                    organizationSelect.innerHTML = '';
                    
                    // Add default options
                    organizationSelect.innerHTML = `
                        <option value="">{{ _('Select an organization...') }}</option>
                        <option value="new"><strong>{{ _('Create New Organization') }}</strong></option>
                    `;
                    
                    // Add organizations
                    data.result.forEach(function(org) {
                        const option = document.createElement('option');
                        option.value = org.name;
                        option.textContent = org.display_name || org.title;
                        organizationSelect.appendChild(option);
                    });
                    
                    console.log('Organizations loaded successfully:', data.result.length, 'organizations');
                }
            })
            .catch(error => {
                console.error('Error loading organizations:', error);
                organizationSelect.innerHTML = `
                    <option value="">{{ _('Select an organization...') }}</option>
                    <option value="new"><strong>{{ _('Create New Organization') }}</strong></option>
                    <option value="" disabled>{{ _('Error loading organizations') }}</option>
                `;
            });
    }
    
    // Initialize form
    function initializeForm() {
        // Set initial states
        genderOtherText.style.display = 'none';
        newOrganizationField.style.display = 'none';
        
        // Load organizations
        loadOrganizations();
        
        // Add event listeners
        genderSelect.addEventListener('change', toggleGenderOtherField);
        organizationSelect.addEventListener('change', toggleNewOrganizationField);
        passwordField.addEventListener('input', checkPasswordMatch);
        confirmPasswordField.addEventListener('input', checkPasswordMatch);
        form.addEventListener('submit', handleFormSubmit);
        
        // Check initial state of organization selection
        toggleNewOrganizationField();
        toggleGenderOtherField();
        
        // Initialize reCAPTCHA when ready
        if (typeof grecaptcha !== 'undefined') {
            initializeRecaptcha();
        } else {
            window.addEventListener('load', initializeRecaptcha);
        }
        
        console.log('Form initialized successfully');
    }
    
    // Gender field toggle
    function toggleGenderOtherField() {
        const isOtherSelected = genderSelect.value === 'other';
        
        if (isOtherSelected) {
            genderOtherText.style.display = 'block';
            genderOtherText.disabled = false;
            genderOtherText.required = true;
        } else {
            genderOtherText.style.display = 'none';
            genderOtherText.disabled = true;
            genderOtherText.required = false;
            genderOtherText.value = '';
        }
    }
    
    // Organization field toggle
    function toggleNewOrganizationField() {
        const isNewOrganization = organizationSelect.value === 'new';
        
        console.log('Organization changed:', organizationSelect.value, 'isNew:', isNewOrganization);
        
        if (isNewOrganization) {
            newOrganizationField.style.display = 'block';
            newOrganizationNameField.required = true;
            // Set role to admin and disable selector
            userRoleSelect.value = 'admin';
            userRoleSelect.disabled = true;
            userRoleSelect.classList.add('disabled-select');
            console.log('Role set to admin and disabled');
        } else {
            newOrganizationField.style.display = 'none';
            newOrganizationNameField.required = false;
            newOrganizationNameField.value = '';
            document.getElementById('new_organization_description').value = '';
            // Enable role selector
            userRoleSelect.disabled = false;
            userRoleSelect.classList.remove('disabled-select');
            // Set default role to member if not new organization
            if (!userRoleSelect.value) {
                userRoleSelect.value = 'member';
            }
            console.log('Role selector enabled');
        }
    }
    
    // Password matching validation
    function checkPasswordMatch() {
        const password = passwordField.value;
        const confirmPassword = confirmPasswordField.value;
        
        if (password === confirmPassword && password.length > 0) {
            matchMessage.innerHTML = "{{ _('Passwords match!') }}";
            matchMessage.className = "success-message";
        } else if (confirmPassword.length > 0) {
            matchMessage.innerHTML = "{{ _('Passwords do not match') }}";
            matchMessage.className = "error-message";
        } else {
            matchMessage.innerHTML = "";
            matchMessage.className = "";
        }
    }
    
    // Duplicate organization check
    function checkDuplicateOrganization() {
        if (organizationSelect.value !== 'new') return true;
        
        const newOrgName = newOrganizationNameField.value.trim();
        const existingOrganizations = Array.from(organizationSelect.options)
            .map(option => option.text.toLowerCase())
            .filter(name => name !== '');
        
        if (existingOrganizations.includes(newOrgName.toLowerCase())) {
            alert("{{ _('This organization already exists in the list.') }}");
            newOrganizationNameField.focus();
            return false;
        }
        
        return true;
    }
    
    // reCAPTCHA initialization
    function initializeRecaptcha() {
        if (typeof grecaptcha === 'undefined') {
            console.warn('reCAPTCHA not loaded');
            return;
        }
        
        grecaptcha.ready(function() {
            console.log('reCAPTCHA ready');
        });
    }
    
    // Form submission handler
    function handleFormSubmit(event) {
        event.preventDefault();
        console.log('Form submission initiated');
        
        // Add loading state
        submitButton.classList.add('loading');
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fa fa-spinner fa-spin"></i> {{ _("Processing...") }}';
        
        // Manual validation since we have novalidate
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        let firstInvalidField = null;
        
        requiredFields.forEach(function(field) {
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add('is-invalid');
                if (!firstInvalidField) {
                    firstInvalidField = field;
                }
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        // Check password match
        if (passwordField.value !== confirmPasswordField.value) {
            isValid = false;
            alert("{{ _('Passwords do not match!') }}");
            confirmPasswordField.focus();
            submitButton.classList.remove('loading');
            submitButton.disabled = false;
            submitButton.innerHTML = '<i class="fa fa-paper-plane"></i> {{ _("Submit Application") }}';
            return;
        }
        
        if (!isValid) {
            alert("{{ _('Please fill in all required fields.') }}");
            if (firstInvalidField) {
                firstInvalidField.focus();
            }
            submitButton.classList.remove('loading');
            submitButton.disabled = false;
            submitButton.innerHTML = '<i class="fa fa-paper-plane"></i> {{ _("Submit Application") }}';
            return;
        }
        
        // Check for duplicate organization
        if (!checkDuplicateOrganization()) {
            submitButton.classList.remove('loading');
            submitButton.disabled = false;
            submitButton.innerHTML = '<i class="fa fa-paper-plane"></i> {{ _("Submit Application") }}';
            return;
        }
        
        // Check if reCAPTCHA is configured
        const siteKey = '{{ h.get_site_key() }}';
        console.log('reCAPTCHA site key present:', !!siteKey);
        
        // Execute reCAPTCHA if available and configured
        if (typeof grecaptcha !== 'undefined' && siteKey) {
            console.log('Executing reCAPTCHA...');
            grecaptcha.ready(function() {
                grecaptcha.execute(siteKey, {action: 'submit'})
                    .then(function(token) {
                        console.log('reCAPTCHA token received');
                        document.getElementById('recaptchaResponse').value = token;
                        console.log('Submitting form...');
                        form.submit();
                    })
                    .catch(function(error) {
                        console.error('reCAPTCHA error:', error);
                        alert("{{ _('reCAPTCHA verification failed. Please try again.') }}");
                        submitButton.classList.remove('loading');
                        submitButton.disabled = false;
                        submitButton.innerHTML = '<i class="fa fa-paper-plane"></i> {{ _("Submit Application") }}';
                    });
            });
        } else {
            // Fallback if reCAPTCHA is not available
            console.warn('reCAPTCHA not available or not configured, submitting without verification');
            console.log('Submitting form without reCAPTCHA...');
            
            // Add a visual indicator that form is being submitted
            const loadingDiv = document.createElement('div');
            loadingDiv.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;';
            loadingDiv.innerHTML = '<div style="background: white; padding: 20px; border-radius: 10px;"><i class="fa fa-spinner fa-spin"></i> {{ _("Submitting form...") }}</div>';
            document.body.appendChild(loadingDiv);
            
            // Submit the form
            setTimeout(function() {
                console.log('Form action:', form.action);
                console.log('Form method:', form.method);
                form.submit();
            }, 100);
        }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeForm);
    } else {
        initializeForm();
    }
    
})();
</script>

<style>
/* Data Contributor Registration Form - Professional Theme */
:root {
  --unesco-blue: #0072BC;
  --unesco-blue-dark: #005A9C;
  --unesco-blue-light: #009EE0;
  --unesco-blue-pale: #E3F2FD;
  --text-primary: #2c3e50;
  --text-secondary: #6c757d;
  --success-color: #4caf50;
  --error-color: #f44336;
  --warning-color: #ff9800;
  --shadow-light: 0 2px 8px rgba(0, 114, 188, 0.08);
  --shadow-medium: 0 4px 16px rgba(0, 114, 188, 0.12);
}

.contributor-registration-form {
  max-width: 100%;
  margin: 0;
  padding: 0;
}

/* Form Header */
.form-header {
  text-align: center;
  margin-bottom: 2rem;
}

.form-header h1 {
  color: var(--unesco-blue-dark);
  font-size: 2rem;
  font-weight: 700;
  margin: 0 0 0.5rem 0;
  line-height: 1.3;
}

.form-subtitle {
  color: var(--text-secondary);
  font-size: 1.1rem;
  margin: 0;
  font-weight: 400;
  line-height: 1.4;
}

/* Form Introduction */
.form-intro {
  margin-bottom: 3rem;
}

.intro-card {
  background: linear-gradient(135deg, var(--unesco-blue-pale) 0%, #ffffff 100%);
  border-radius: 16px;
  padding: 2rem;
  border-left: 6px solid var(--unesco-blue);
  box-shadow: var(--shadow-light);
}

.intro-content p {
  margin-bottom: 1.5rem;
  line-height: 1.6;
  color: var(--text-primary);
  font-size: 1rem;
}

.intro-content p:last-child {
  margin-bottom: 0;
}

/* Form Sections */
.form-section {
  margin-bottom: 3rem;
  border: none;
  border-radius: 20px;
  background: #fff;
  box-shadow: var(--shadow-medium);
  transition: all 0.3s ease;
  overflow: hidden;
  border-left: 6px solid var(--unesco-blue-dark);
}

.form-section:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium);
}

.form-section legend {
  background: linear-gradient(135deg, var(--unesco-blue-pale) 0%, #ffffff 100%);
  color: var(--unesco-blue-dark);
  font-weight: 700;
  padding: 1.5rem 2.5rem;
  margin: 0;
  font-size: 1.4rem;
  border: none;
  width: 100%;
  border-bottom: 3px solid var(--unesco-blue-pale);
  border-radius: 25px;
}

.form-section-content {
  padding: 2.5rem;
}

.section-description {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  border-left: 4px solid var(--unesco-blue-light);
  font-style: italic;
  line-height: 1.6;
  color: var(--text-primary);
}

.demographics-intro,
.organization-intro,
.platforms-intro {
  margin-bottom: 2rem;
}

/* Form Groups */
.form-group {
  margin-bottom: 2rem;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-bottom: 2rem;
}

@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
}

/* Labels */
label {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
  display: block;
  font-size: 1rem;
}

.required {
  position: relative;
}

.text-danger {
  color: var(--error-color);
  font-weight: 700;
}

/* Form Controls */
.form-control {
  width: 100%;
  border-radius: 12px;
  border: 2px solid #e9ecef;
  padding: 14px 18px;
  font-size: 1rem;
  transition: all 0.3s ease;
  background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
  box-shadow: var(--shadow-light);
  margin-bottom: 0.5rem;
  min-height: 3.2em;
  box-sizing: border-box;
  display: flex;
  align-items: center;
}

.form-control:focus {
  border-color: var(--unesco-blue-dark);
  box-shadow: 0 0 0 0.2rem rgba(0, 90, 156, 0.25);
  outline: none;
  background: #ffffff;
  transform: translateY(-1px);
}

/* Ensure focus state maintains proper height for selects */
select.form-control:focus {
  height: 3.2em;
  min-height: 3.2em;
}

/* Ensure focus state for inputs */
input.form-control:focus {
  height: 3.2em;
  min-height: 3.2em;
}

.form-control:disabled,
.disabled-select {
  background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%) !important;
  cursor: not-allowed !important;
  color: var(--text-secondary) !important;
  border-color: #d6d8db !important;
  opacity: 0.7;
}

.form-control:disabled:focus,
.disabled-select:focus {
  border-color: #d6d8db !important;
  box-shadow: none !important;
  transform: none !important;
}

/* Input Fields */
input.form-control {
  height: 3.2em;
  min-height: 3.2em;
}

/* Textarea Fields */
textarea.form-control {
  min-height: 6em;
  height: auto;
  display: block;
  align-items: stretch;
  resize: vertical;
}

label:after {
    content: "" !important;
}

/* Select Fields */
select.form-control {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23666' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 15px center;
  background-size: 12px;
  cursor: pointer;
  padding-right: 35px;
  height: 3.2em;
  min-height: 3.2em;
}

/* Help Text */
.help-text {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin-top: 0.25rem;
  line-height: 1.4;
}

/* Error Messages */
.field-error {
  color: var(--error-color);
  font-size: 0.875rem;
  margin-top: 0.25rem;
  display: none;
}

.field-error.show {
  display: block;
}

.error-message {
  color: var(--error-color);
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

.success-message {
  color: var(--success-color);
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

/* Password Strength */
.password-strength {
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

.password-strength.weak {
  color: var(--error-color);
}

.password-strength.medium {
  color: var(--warning-color);
}

.password-strength.strong {
  color: var(--success-color);
}

/* New Organization Fields */
.new-organization-fields {
  display: none;
  background: linear-gradient(135deg, var(--unesco-blue-pale) 0%, #ffffff 100%);
  padding: 1.5rem;
  border-radius: 12px;
  margin-top: 1rem;
  border: 2px solid var(--unesco-blue-light);
}

/* Terms Section */
.terms-section {
  margin: 3rem 0;
  padding: 2rem;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 16px;
  border-left: 6px solid var(--unesco-blue);
}

.checkbox-container {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
}

.checkbox-container input[type="checkbox"] {
  margin-top: 0.25rem;
  transform: scale(1.2);
  accent-color: var(--unesco-blue);
}

.checkbox-label {
  font-size: 0.95rem;
  line-height: 1.5;
  color: var(--text-primary);
  cursor: pointer;
}

/* reCAPTCHA Section */
.recaptcha-section {
  margin: 2rem 0;
  text-align: center;
}

/* Form Actions */
.form-actions {
  text-align: center;
  margin-top: 3rem;
  padding: 2rem;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.btn {
  border-radius: 25px;
  padding: 14px 32px;
  font-weight: 600;
  font-size: 1.1rem;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-primary {
  background: linear-gradient(135deg, var(--unesco-blue-dark) 0%, var(--unesco-blue) 100%);
  color: white;
  box-shadow: var(--shadow-medium);
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 90, 156, 0.4);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.btn-lg {
  padding: 16px 40px;
  font-size: 1.2rem;
  min-height: 3.6em;
  display: flex;
  align-items: center;
  justify-content: center;
}

.submit-help-text {
  margin-top: 1rem;
  font-size: 0.9rem;
  color: var(--text-secondary);
  font-style: italic;
}

/* Loading State */
.btn.loading {
  opacity: 0.7;
  pointer-events: none;
}

.btn.loading::after {
  content: "";
  width: 16px;
  height: 16px;
  margin-left: 8px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Invalid field styling */
.form-control.is-invalid {
  border-color: var(--error-color) !important;
  background-color: #fee;
}

.form-control.is-invalid:focus {
  box-shadow: 0 0 0 0.2rem rgba(244, 67, 54, 0.25);
}

/* Spinner animation */
.fa-spinner.fa-spin {
  animation: fa-spin 1s linear infinite;
}

@keyframes fa-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Placeholder Styling */
::placeholder {
  color: #999;
  opacity: 1;
}

:-ms-input-placeholder {
  color: #999;
}

::-ms-input-placeholder {
  color: #999;
}

/* Responsive Design */
@media (max-width: 768px) {
  .form-header h1 {
    font-size: 1.75rem;
  }
  
  .form-section-content {
    padding: 1.5rem;
  }
  
  .intro-card {
    padding: 1.5rem;
  }
  
  .form-section legend {
    padding: 1rem 1.5rem;
    font-size: 1.2rem;
  }
  
  .btn-lg {
    padding: 14px 30px;
    font-size: 1.1rem;
  }
}

@media (max-width: 480px) {
  .form-header h1 {
    font-size: 1.5rem;
  }
  
  .form-section-content {
    padding: 1rem;
  }
  
  .intro-card {
    padding: 1rem;
  }
  
  .form-section legend {
    padding: 0.75rem 1rem;
    font-size: 1.1rem;
  }
  
  .checkbox-container {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .terms-section,
  .form-actions {
    padding: 1.5rem;
  }
}
</style>
